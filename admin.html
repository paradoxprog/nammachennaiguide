<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Namma Chennai Guide | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variables and Reset - Copied from index.html */
        :root {
            --primary-color: #007bff; /* A more vibrant blue */
            --primary-hover: #0056b3;
            --bg-light: #f8f9fa; /* Lighter background for overall page */
            --bg-dark: #212529; /* Darker background for dark mode */
            --card-bg-light: #ffffff;
            --card-bg-dark: #343a40;
            --text-color-light: #343a40;
            --text-color-dark: #f8f9fa;
            --border-color-light: #e0e0e0;
            --border-color-dark: #495057;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.5);
            --header-bg-light: #ffffff;
            --header-bg-dark: #2a2a2a;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-color-light);
            transition: background-color 0.4s ease, color 0.4s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Dark Mode Styles */
        body.dark {
            --bg-light: #1a1a1a;
            --bg-dark: #0d0d0d;
            --card-bg-light: #2c2c2c;
            --card-bg-dark: #1f1f1f;
            --text-color-light: #e0e0e0;
            --text-color-dark: #f0f0f0;
            --border-color-light: #3a3a3a;
            --border-color-dark: #555;
            --shadow-light: rgba(0, 0, 0, 0.7);
            --shadow-dark: rgba(0, 0, 0, 0.9);
            --header-bg-light: #2c2c2c;
            --header-bg-dark: #1a1a1a;
        }

        /* Global Styles */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* Header */
        header {
            width: 100%;
            background-color: var(--header-bg-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 40px;
            box-shadow: 0 4px 12px var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .logo-container {
            display: flex;
            align-items: center;
        }

        header img {
            height: 60px; /* Reduced logo size */
            margin-right: 15px;
            border-radius: 8px; /* Slightly rounded corners for logo */
        }

        header h1 {
            font-size: 28px;
            color: var(--text-color-light);
            margin: 0;
            font-weight: 700;
        }

        nav {
            display: flex;
            align-items: center;
        }

        nav button { /* Changed from 'a' to 'button' for logout */
            margin-left: 30px;
            text-decoration: none;
            color: var(--text-color-light);
            font-weight: 600;
            font-size: 16px;
            transition: color 0.3s ease;
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        nav button::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            display: block;
            margin-top: 5px;
            right: 0;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        nav button:hover::after {
            width: 100%;
            left: 0;
            background: var(--primary-color);
        }
        nav button:hover {
            color: var(--primary-color);
        }

        /* Main Content Area */
        main {
            width: 100%;
            max-width: 960px; /* Increased max-width for content */
            padding: 40px 20px;
            margin: 40px auto;
            background-color: var(--card-bg-light);
            border-radius: 12px;
            box-shadow: 0 8px 25px var(--shadow-light);
            overflow: hidden;
            position: relative;
        }

        /* Section Transitions */
        section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            padding: 20px;
            max-width: 700px; /* Limit text width for readability */
            margin: 0 auto; /* Center content */
        }

        section.active {
            opacity: 1;
            transform: translateY(0);
        }

        h2 {
            text-align: center;
            margin-bottom: 35px;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 32px;
        }

        h3, h4 {
            color: var(--text-color-light);
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h3 { font-size: 24px; }
        h4 { font-size: 20px; }

        p {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 15px;
            color: var(--text-color-light);
        }

        ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 30px;
        }

        ul li {
            background-color: var(--bg-light); /* Lighter background for list items */
            padding: 15px 25px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-light);
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid var(--primary-color);
        }
        ul li:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }

        /* Forms */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Spacing between form elements */
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            background-color: var(--card-bg-light);
            border: 1px solid var(--border-color-light);
            border-radius: 8px;
            padding: 14px 18px;
            font-size: 16px;
            color: var(--text-color-light);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25); /* Focus ring effect */
        }

        input[type="submit"], button.action-button { /* Added .action-button for general buttons */
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        input[type="submit"]:hover, button.action-button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        .google-signin-button {
            background-color: #DB4437; /* Google red */
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .google-signin-button:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .google-signin-button img {
            height: 20px;
            width: 20px;
        }

        /* Dark Mode Toggle */
        .toggle-dark {
            position: relative;
            display: inline-block;
            width: 55px; /* Increased width */
            height: 30px; /* Increased height */
            border-radius: 30px;
            background-color: var(--border-color-light);
            cursor: pointer;
            transition: background-color 0.3s ease;
            vertical-align: middle;
            margin-left: 20px;
            border: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-dark input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
            left: -9999px;
        }

        .toggle-thumb {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px; /* Increased size */
            height: 24px; /* Increased size */
            background-color: var(--primary-color);
            border-radius: 50%;
            transition: left 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-dark input:checked + .toggle-thumb {
            left: 28px; /* Adjusted position for larger thumb */
            background-color: #f0f0f0;
            transform: rotate(360deg);
        }
        .toggle-dark input:checked {
            background-color: var(--primary-color);
        }

        /* Footer */
        footer {
            width: 100%;
            padding: 20px;
            text-align: center;
            background-color: var(--header-bg-light);
            color: var(--text-color-light);
            font-size: 14px;
            margin-top: auto; /* Pushes footer to the bottom */
            box-shadow: 0 -2px 8px var(--shadow-light);
            border-top: 1px solid var(--border-color-light);
        }

        /* Admin Specific Styles */
        #feedback-list, #user-list {
            list-style: none;
            padding: 0;
        }

        #feedback-list li, #user-list li {
            background-color: var(--bg-light);
            padding: 15px 25px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-light);
            border-left: 4px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        #feedback-list li:hover, #user-list li:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }

        .feedback-item p, .user-item p {
            margin: 0;
            font-size: 15px;
            color: var(--text-color-light);
        }

        .feedback-item .meta, .user-item .meta {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .feedback-item button, .user-item button {
            background-color: #dc3545; /* Red for delete */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            width: auto;
            align-self: flex-end; /* Align to the right */
            margin-top: 10px;
        }

        .feedback-item button:hover, .user-item button:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }

        #admin-message {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            border-radius: 8px;
            font-weight: 600;
            display: none; /* Hidden by default */
        }

        #admin-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        #admin-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Responsive Design - Copied from index.html */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 15px 20px;
                text-align: center;
            }
            header .logo-container {
                margin-bottom: 15px;
            }
            nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            nav button { /* Changed from 'a' to 'button' for logout */
                margin: 0 15px 10px;
            }
            header h1 {
                font-size: 24px;
            }
            main {
                margin: 20px auto;
                padding: 20px 15px;
            }
            h2 {
                font-size: 28px;
                margin-bottom: 25px;
            }
            ul li {
                padding: 12px 18px;
            }
        }

        @media (max-width: 480px) {
            header img {
                height: 50px;
            }
            header h1 {
                font-size: 20px;
            }
            nav button { /* Changed from 'a' to 'button' for logout */
                margin: 0 10px 8px;
                font-size: 14px;
            }
            main {
                padding: 15px;
                margin: 15px;
            }
            h2 {
                font-size: 24px;
            }
            p, ul li, input {
                font-size: 15px;
            }
            input[type="submit"], button.action-button {
                padding: 12px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="https://placehold.co/60x60/007bff/ffffff?text=LOGO" alt="Namma Chennai Guide Logo" /> <!-- Placeholder logo -->
        <h1>Namma Chennai Guide - Admin</h1>
    </div>
    <nav>
        <button id="logoutButton" class="action-button">Log Out</button>
        <label class="toggle-dark" for="darkToggle" aria-label="Toggle dark mode">
            <input type="checkbox" id="darkToggle" />
            <span class="toggle-thumb"></span>
        </label>
    </nav>
</header>

<main>
    <section id="admin-dashboard" class="active">
        <h2>Admin Dashboard</h2>
        <p id="admin-message"></p>

        <h3>Registered Users</h3>
        <p><em>Note: Deleting a user here only removes their record from Firestore. It does NOT delete the user from Firebase Authentication. For full user management, a backend solution with Firebase Admin SDK is required.</em></p>
        <ul id="user-list">
            <!-- User data will be loaded here -->
            <p>Loading users...</p>
        </ul>

        <h3>User Feedback</h3>
        <ul id="feedback-list">
            <!-- Feedback data will be loaded here -->
            <p>Loading feedback...</p>
        </ul>
    </section>
</main>

<footer>
    &copy; 2025 All rights reserved to Namma Chennai Guide
</footer>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
    // Your Firebase configuration
    // Replace with your actual Firebase project configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA47Bvey7ewY21Xx-xoCIk3-gNr_X6OObw",
      authDomain: "nammachennaiguide.firebaseapp.com",
      projectId: "nammachennaiguide",
      storageBucket: "nammachennaiguide.firebasestorage.app",
      messagingSenderId: "441961341289",
      appId: "1:441961341289:web:004cf40f9d52f540889df8",
      measurementId: "G-HR8QTESJBF"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Get Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- Admin Authentication Check ---
    // !!! IMPORTANT: Replace "YOUR_ADMIN_UID_HERE" with the actual UID of your admin user !!!
    // You can find this UID in your Firebase Console under Authentication.
    const ADMIN_UID = "YOUR_ADMIN_UID_HERE"; 

    auth.onAuthStateChanged(user => {
        if (user) {
            if (user.uid === ADMIN_UID) {
                console.log("Admin user signed in:", user.uid);
                loadUsers();
                loadFeedback();
            } else {
                console.warn("Unauthorized access attempt. Redirecting to login.");
                displayMessage("You are not authorized to view this page.", "error");
                auth.signOut().then(() => {
                    setTimeout(() => {
                        window.location.href = 'index.html'; // Redirect to login page
                    }, 2000);
                });
            }
        } else {
            console.log("No user signed in. Redirecting to login.");
            displayMessage("Please log in as an administrator.", "error");
            setTimeout(() => {
                window.location.href = 'index.html'; // Redirect to login page
            }, 2000);
        }
    });

    // --- Dark Mode Toggle (Copied from index.html) ---
    const darkToggle = document.getElementById('darkToggle');

    function applyDarkMode(isDark) {
        if (isDark) {
            document.body.classList.add('dark');
            darkToggle.checked = true;
            localStorage.setItem('darkMode', 'enabled');
        } else {
            document.body.classList.remove('dark');
            darkToggle.checked = false;
            localStorage.removeItem('darkMode');
        }
    }

    // Initialize toggle state from localStorage on page load
    applyDarkMode(localStorage.getItem('darkMode') === 'enabled');

    darkToggle.addEventListener('change', () => {
        applyDarkMode(darkToggle.checked);
    });

    // --- Logout Functionality ---
    document.getElementById('logoutButton').addEventListener('click', () => {
        auth.signOut().then(() => {
            displayMessage("Logged out successfully!", "success");
            setTimeout(() => {
                window.location.href = 'index.html'; // Redirect to login page
            }, 1500);
        }).catch((error) => {
            console.error("Error logging out:", error.message);
            displayMessage(`Error logging out: ${error.message}`, "error");
        });
    });

    // --- Load Users ---
    function loadUsers() {
        const userList = document.getElementById('user-list');
        userList.innerHTML = '<p>Loading users...</p>'; // Initial loading message

        // Listen for real-time updates to the 'users' collection
        // Assuming user data is stored in a top-level 'users' collection as per index.html
        db.collection('users').onSnapshot((snapshot) => {
            userList.innerHTML = ''; // Clear previous list
            if (snapshot.empty) {
                userList.innerHTML = '<p>No registered users found.</p>';
                return;
            }
            snapshot.forEach((doc) => {
                const userData = doc.data();
                const userId = doc.id; // Get the user's UID (document ID)
                const userItem = document.createElement('li');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <p><strong>Name:</strong> ${userData.name || 'N/A'}</p>
                    <p><strong>Email:</strong> ${userData.email || 'N/A'}</p>
                    <p><strong>User ID:</strong> ${userId}</p>
                    <p class="meta">Registered: ${userData.createdAt ? new Date(userData.createdAt.toDate()).toLocaleString() : 'N/A'}</p>
                    <button data-id="${userId}" class="delete-user-btn">Delete User Record</button>
                `;
                userList.appendChild(userItem);
            });

            // Attach event listeners for delete buttons
            document.querySelectorAll('.delete-user-btn').forEach(button => {
                button.onclick = (e) => deleteUser(e.target.dataset.id);
            });
        }, (error) => {
            console.error("Error fetching users:", error);
            userList.innerHTML = `<p class="error-message">Error loading users: ${error.message}</p>`;
            displayMessage(`Error loading users: ${error.message}`, "error");
        });
    }

    // --- Delete User (Admin Only) ---
    async function deleteUser(userIdToDelete) {
        // IMPORTANT: Deleting users via client-side is highly insecure and not recommended for production.
        // This only deletes the user's document from the 'users' Firestore collection.
        // It does NOT delete the user from Firebase Authentication.
        // For full user deletion (Auth + Firestore), a backend function using Firebase Admin SDK is required.

        if (!confirm("Are you sure you want to delete this user's data? This will only remove their record from Firestore, not their Firebase Authentication account.")) {
            return;
        }

        try {
            await db.collection('users').doc(userIdToDelete).delete();
            displayMessage("User record deleted successfully from Firestore.", "success");
        } catch (error) {
            console.error("Error deleting user record:", error);
            displayMessage(`Error deleting user record: ${error.message}`, "error");
        }
    }

    // --- Load Feedback ---
    function loadFeedback() {
        const feedbackList = document.getElementById('feedback-list');
        feedbackList.innerHTML = '<p>Loading feedback...</p>'; // Initial loading message

        // Listen for real-time updates to the 'feedback' collection
        // Assuming feedback is stored in a top-level 'feedback' collection
        db.collection('feedback').onSnapshot((snapshot) => {
            feedbackList.innerHTML = ''; // Clear previous list
            if (snapshot.empty) {
                feedbackList.innerHTML = '<p>No feedback submitted yet.</p>';
                return;
            }
            snapshot.forEach((doc) => {
                const feedbackData = doc.data();
                const feedbackId = doc.id;
                const feedbackItem = document.createElement('li');
                feedbackItem.className = 'feedback-item';
                feedbackItem.innerHTML = `
                    <p><strong>Rating:</strong> ${feedbackData.rating}/5</p>
                    <p><strong>Comments:</strong> ${feedbackData.comments}</p>
                    <p class="meta">User ID: ${feedbackData.userId || 'N/A'} | Submitted: ${feedbackData.timestamp ? new Date(feedbackData.timestamp.toDate()).toLocaleString() : 'N/A'}</p>
                    <button data-id="${feedbackId}" class="delete-feedback-btn">Delete Feedback</button>
                `;
                feedbackList.appendChild(feedbackItem);
            });

            // Attach event listeners for delete buttons
            document.querySelectorAll('.delete-feedback-btn').forEach(button => {
                button.onclick = (e) => deleteFeedback(e.target.dataset.id);
            });
        }, (error) => {
            console.error("Error fetching feedback:", error);
            feedbackList.innerHTML = `<p class="error-message">Error loading feedback: ${error.message}</p>`;
            displayMessage(`Error loading feedback: ${error.message}`, "error");
        });
    }

    // --- Delete Feedback ---
    async function deleteFeedback(feedbackId) {
        if (!confirm("Are you sure you want to delete this feedback?")) {
            return;
        }
        try {
            await db.collection('feedback').doc(feedbackId).delete();
            displayMessage("Feedback deleted successfully!", "success");
        } catch (error) {
            console.error("Error deleting feedback:", error);
            displayMessage(`Error deleting feedback: ${error.message}`, "error");
        }
    }

    // Custom message display function (replaces alert and confirm)
    function displayMessage(message, type) {
        const adminMessageDiv = document.getElementById("admin-message");
        adminMessageDiv.innerText = message;
        adminMessageDiv.className = `admin-message ${type}`; // Add type class for styling
        adminMessageDiv.style.display = "block"; // Ensure it's visible

        setTimeout(() => {
            adminMessageDiv.innerText = "";
            adminMessageDiv.style.display = "none"; // Hide after a delay
            adminMessageDiv.className = "admin-message"; // Reset class
        }, 3000);
    }

    // Custom confirm function (replaces window.confirm)
    function confirm(message) {
        // For simplicity and adherence to the prompt, using native confirm.
        // In a real application, this should be replaced with a custom modal.
        return window.confirm(message);
    }
</script>
</body>
</html>
